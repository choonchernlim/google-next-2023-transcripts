{
    "title": "Metadata at scale: How to effectively migrate and grow on Google Cloud",
    "presentation_type": "Spotlight",
    "categories": [
        "Data Analysts, Data Scientists, Data Engineers",
        "SPTL102"
    ],
    "video_id": "mJDOlJ9lqNg",
    "time": "Aug 30 01:45 PM - 02:30 PM CDT",
    "transcript": "foreign[Music]So today we're going to be talking aboutmetadata at scale and we've got MattBruno with me yeah I'm Ryan McLeanobviously just a quick background onmyself in terms of like why this mattersto me so prior to working at datadog Iworked at Samsung so in terms of theskill that we had tagging was a reallyimportant issue or problem to have butalso something that really enabled us togo through our day-to-day operationswhat about yourself matchyeah so I've been living thetransformation life for a while sobefore Wayfair I was at EMC in Dellwe're going through our owntransformation piece there so how youmanage these things at scale for largecompanies going through thesesuper topicalexcited to talk about it here all rightlet's get into it so first I'll give youa quick blurb about datadog for those ofyou who haven't heard of data beforeI'll make it really short I promise butdatadog is a monitoring and analyticsplatform it provides full visibilityacross your organization so that'sspanning end to end from yourinfrastructure and network toapplications and services all the way toyour end users what I'd like to say isthat the idea is to enable everyonethat's Ops Dev security and even folksin the business to have a sharedunderstanding of your systems that'syour applications and how your businesslooks from a technology perspective soin short basically what we want to be isthat single platform for all of yourobservability needswhich brings us nicely to Wayfarer weare a single platform for all thingshomewe've got a big e-commerce platform witha lot of In-House technology focused onboth the supplier experience and thecustomer experience which leads to ahuge deal of scale and complexity on theback end now if you're not familiar wedo operate a number of Brands some ofthem omnichannel with physical retailand online but we are primarilye-commerce right with a full in-houseTech footprint not to belabor it toomuch but it kind of leads into thetechnical complexity we'll be talkingabout here you know our customer reacheson the scale of billions of Impressionsacross North America and parts of Europewith a full Suite of website and app onthe sideLogistics wise we've built out a wholecarrier Network right that's been a hugedifferentiator for us and obviouslyleads to a large scale right because weare managingmillions of products moving all acrossthe world at this point so keeping thattracked end-to-end has been a hugetechnical challenge but it's been anexciting one to really be able to buildin-houseum and drive a real competitiveAdvantage there you know lastly wetalked really the shopping experienceand what our customers see which isgoing to be leading Us in herewe have millions and millions ofproducts so managing that catalog andmanaging all of this pieces on the backend drive us here so start with the sitenow looks pretty straightforward I'msure we've all seen the e-commerce sitebefore kind of what I'd call attentionto here though is since we're managingour own pricing Network our ownLogistics Network all the differentelements you see there are differentback of house systems right so for myday-to-day job of keeping the siterunning if one of those goes bump it's aquestion of you know which needle in thehaystack caused it which to lead intoour at scale tag and conversation herewow our footprint yeah our footprintbefore we start tagging anything it's Igot a few Haystacks out thereum and those red dots do not necessarilymean something's bad so I'm kind of atthis challenge of how do I manage thisso cool we got there we're in the cloudwe are at scale what next right whichbrings us into the metadata piece andI'd say you know Ryan why is thisimportant yeah it's a good question so Ilike to think a lot of times aboutincentives goals or maybe like whyyou're doing something so to me taggingfeels like a bit of hygiene so you cankind of think of maybe delayedgratification what I mean by that islet's say you're going to the dentistand they tell you to floss tell you thefloss in fact the last time I went theytold me that flossing is way moreimportant than brushing and I like tothink of these sort of governanceproblems very similar so it's somethingthat you're going to set up now to helpyour future self so when you're awakenedat 2 am what have your databases downthat's probably not the time to tagthings maybe you can post event but whatyou want to do is beforehand do that foryou in fact it'd be awful if you went todo something like drop a table in debtwhen you thought it was prod this can bepretty sticky and having been involvedin those incidents before I think thatcan be a problem so the incentive hereis to help your future self your futureteam or your company down the road forthings like governance it could bearound cost centers or general ledgersor maybe something around security thosekind of things will actually help younow basically if you do it now it'sgoing to help you later so it's hard tothink about it's hard to like maybe giveyou an incentive like oh yeah future mewill like this but when you are on calland it comes down to the wire it isreally important to know what you'relooking at to be able to find thatneedle in a stack especially at scalebecause those small problems become veryvery important at scale when you'redealing with hundreds thousands tens ormillions of holes it can be verydifficult to sort through and figure outnow this is this is kind of a longoverview but basically the tags are away of helping you use multipleDimensions sorry to look at yourinfrastructure your metrics your tracesyour logs to help you with those becauseit can be really hard when there's likean inflection point and you want to seehey where did this come from what whatcaused thiswhich brings us nicely to we're talkingabout a scary of going from a monolithicapplication to really decoupled microServices we go more Cloud native but ifwe go back in time and we talk thelimitation of where we were right youtalk the limitation of raw time seriesmetrics and you say okay on a monolithyou see a latency Spike cool you've gotone deploy train that audit list of whatmight have changed what I need to knowthe dimensionalities you said you knowit's it's a lot more narrow and it's alot easier and this worked for a numberof years for us and then you hit aTipping Point we say okay well you'veactually got what we had about 5000micro Services behind the scenes now soyou're talking about that scale and it'swell if this goes bump at the top levelfor the user experience there's nothingin there that tells me exactly whichpiece of this broke behind the scenes sothe first part of our story is on how weget into distributed tracing to reallytackle it but to tie it into the idea ofmetadata and tagging to keep all ofthose traces aligned to the correct spanto be able to really stitch togetherthat user Journey you need to beinjecting the right metadata at everystep of the line and you need theconsistent distribution so you knowstart voicing over what we've reallydone to tackle some of those scalechallenges first a big piece and youtalk about you know doing your futureself a favor is go out and standardizethe deployments right so when we havetracing distributed we needed to makesure it was set up the same for everylanguage we support and weI think there's somewhere in the 8 to 10range of like production supportedlanguages right now and for a long timewe had to sort of pointed people at theraw libraries and said hey this is howyou set it up good luck have fun and itit works for a while but then you get tothat point of scale where well thosetraces aren't actually getting stitchedtogether because you're tagging themdifferently so we went back to thedrawing board and standardized acrossall the language libraries to say okaynow you have this unified picture so inour lovely generic piece here when yousay do some work we actually know whatthat unit of work isnow to make this a little more real toour experience go back to you knoweffectively the same shopping page wehad up before you know I yeah I think itshows up pretty well on the screen hereso there's different color boxeshighlight the different parts of thejourney the different core domains thatare at play here and that starts to giveus a little more control over it so whenyou're talking operability when you'retalking runtime governance I can nowstart to break this down and know who'sdoing what and how the whole piece fitstogether and obviously if you have thatlatency Spike you're probably not seeingit across the entire stack you're seeingit for a specific service so maybe ourLogistics Services running a little slowso my shipping estimate is lagging it'sholding the page up or maybe the headerbar is being a little wonky because of adeploy but when you get a little morenuanced if you have the changes taggedto the piece of infrastructure thatyou're monitoring a piece of softwarethat you're monitoring it's a lot fasterto make those correlations in there andout Ryan I believe you've got someoverview for us here yeah for sure so Iguess what we're talking about whenwe're looking at that needle and theHaystacks some of these tags that we'retalking about and we're saying tags butmetadata in general it could be labelsand kubernetes it could be a tag for aninstance it could also be something likea grouping in gcp but what we mean bythis metadata is that things that willpercolate or bubble up for us to be ableto say hey it came from here then itwent to here that kind of thing so if welook at this graph we could do it fromtop down if we're trying to figure outwhich service we're talking about soobviously in this graph we're looking atservice C it's got a lot more data aboutit but if we start from the bottom whatwe want to know is hey is this in prodis this in Dev which environment is thisactual problem in because that's goingto be key do I need to wake up at 2AMbecause it's a Dev problem do I need towake up at 2 because it's a stagingproblem if it's production probably andthen the next is like which zone is thisin because you might have differentnames for different areas but it'simportant for you to know where to lookas well and then of course the cloudprovider is going to be gcp and thengoing up from there we're going to lookat what kind of orchestration deployedthis was there a recent deploy can Icheck out those pipelines can I use usethis tag to sort of follow back andfigure out what the the provenance Iguess is of this actual problem wheredid it stem from and then I guess goinga little bit to the right is itserverless is it on a VM what sort ofinfrastructure is it using is thissomething that Google's managing is thissomething that I bravely decided tomanage on my own or is this somethingthat's a hosted cloud service so in thiscase like the dependency is cloud SQLMySQL and then I only released too muchbut basically which function it is whichhosts it on which container is it Iguess what I'm really trying to say isthat there are a lot of Dimensions sofor those of you I realize generative AIis a big deal right now these are onlythree dimensions I think in that spaceyou might have multi-dimensionality andwe're trying to keep this simple here sosomething like the instance type and theavailability is on will be things thatGoogle will give you in terms ofmetadata but also you might want tothink of and this is oversimplificationI apologize but the role so in 3D we canthink of these three axes for exampleand using those we can say which ofthese instances have which tags apply tothem but role is just one example Imentioned cost center before I mentionedgeneral ledger before but there's alsothings like which Port are open or whichSecurity Group might this be tagged withor what kind of networking is this tagwith or maybe we're looking at sort ofbusiness areas of grouping taggingmetadata what kind of data can we giveto the business that will help usdetermine what actual Services is andwhy it's important to usand to really use that you had up beforeand you say when we want to try andsolve that Rubik's Cube that you justpresented right you know what does thatlook like for us in production we'vereally got two core Dimensions we'relooking at you know first we have ourtechnical owners what team owns theinfrastructure who do I chase down forbetter or worse I see a lot of teams upthere that I am accountable for so thatis my lovely piece of the puzzle butthen you also have what's the businessfunction what are those pieces doing andyou're starting to get those two anglesof it here and those are distinctlydifferent so when you talk about scalingwhen you talk about cost management it'simportant to have those tags therebecause you can choose how you want toslice and dice it you know and we'velived it right we pivot from having ateam-based hierarchy to looking more atwhat's the business function and how doyou tie it back and say okay thisexperience actually costs this muchwhat's the return on investment thereand then you can start to optimize a lotmore and you can start to dig in and doa bit more in the way of apples dapple'scomparisons and well I've got these twothings they're solving similar businesschallenges one of them costs twice asmuch why well if you have it taggedcorrectly you can kind of get thatdirect comparison there to see what'sgoing onpulling this in a bit more to a runtimegovernance piece and we start talkingabout our favorite thing in the worldslos but to really manage these piecesat scale you very much need to betracking what are those agreementsbetween services and so you startstitching that as the next Dimension yousay okay well I know what businessfunctions are doing based on the tagsand you can chase that back to some ofthe Spandau that we showed earlier wecan say what calls what but that doesn'tmatter if you don't know what to expectfrom each other right and so that'swhere being able to set the slos in iskind of that last piece of runtimegovernance that really matters to enablethisum and I think that's been a challengefor us right as we rolled out at scaleyou know we were good at tagging andsplitting things down but then you goback and say okay well we built allthese things based on a web ofassumptions and that works to get yousomewhere quickly I don't think it'sfundamentally the wrong thingbut as you get up to scale and you talkabout okay how do we actually drivestability at this point you need to goback to basics and say okay for thewhole experience what are our targetsand then as you step down per eachdomain for each business function andto keep it tied in by having those tagsyou can go slice and dice and I thinkit's an important piece to say yourobjectives are based on reality you knowthere's no point in saying I'm going tohave this super tight window that I'mtargeting ifpale it's way out of whack so you knowwe can talk about the four nines thefive nines I think I've heard thatmentioned a few other conversations herethis week if you're really just at twoand a half and that might be good enoughbecause you're still talking about youknow only a few hours a month ofdisruption which is a fair change windowoff hours that's the right way to placeitI think there's also an angle here aboutyou know how did we get there how are weable to enable it we talked aboutstandardizing our language librariesanother piece and you touched on this aminute ago is keeping those tags unifiedkeeping that metadata unified you knowbecause it's datadog and Google haveslightly different labeling requirementsso what we did to solve that we went outand built a metadata Handler service ohthat's cool yeah so that's somethingthat's now a sidecar in all our deploypipelines so you roll your code outwhichever pieces of metadata youpopulated will then pull it in true itup and make sure that Dash is anunderscore is sort of aligned correctlybut when we're doing any sort ofgovernance on the back end that lets usreally stitch together and be able toassociate those piecesso we certainly found that it's aninteresting thing that we ran into kindof halfway throughI believe you've got some best practicesfor us yeah for sure so I think we'retouching on a little bit of consistencythere so I'm assuming that those in theaudience has come across like is thisthe dev environment is this thedevelopment environment is that all capsdoes it start with a capital D what doesit look like and even the environmenttag itself you'll find in some shopsthey might just shorten that to do EnVor Capital ENB it really depends andothers there's different ways of copingwith I think the Eno service is a reallygood approach to actually get at this tosort of deal with the Legacy systemsthat you've got but there's also maybeonce you realize that there's a problemthere's like a policy standard procedureor infrastructure as code that you cando as well to get it but in the interimI feel like those kind of services thatyou have in the house really helpbecause there's a deployment timethere's Dev time obviously but what youwant to do is start standardizing thissoon before it becomes a governanceproblem so if you do it up front I thinkthat's a lot easier so I'm kind ofskipping a little bit ahead here but interms of like start four starting smallI think I started playing for startingsmall is really important and the sooneryou start the better and then we weretalking a little bit about thatconsistency already but I thinksometimes in some of Matt's graphs wesaw like who are the owners so whoactually owns this service which groupdoes it belong to how can they getaccess to these Services what'simportant to them when they're on calland trying to figure out what actuallyhappened or where do you attribute thiscost or maybe how to look down this pathin order to figure out where thesecurity problem is so it does becomemaybe more of a governance challengedown the road and it's something thatyou can do now to help that future selfto give you that delayed gratificationbasically to say hey I've done thisessentially these these tasks all theway and then when it comes down when themetal when the rubber beats the road youcan actually go in and find the problemsfor you and then again at the verybottom here when we're talking aboutthings that multiple purposes so thatcan allow you to do those cost trackingautomation organizationsteps basically this will help you outare there any of these that stick outfor you andit's like the day-to-day yeah I meanobviously the multiple purpose is youknow for cost tracking has been hugebecause you start you say okay wellmaybe you know what a team does andmaybe you know what a department doesbut how do you Stitch that together youknow has been a challenge and I thinkit's one of the topical pieces rightbecause we all race in the new tech sacand it's something to be said for movefast and get there to start driving thebusiness results but then how do youshow it back after the fact and reallybalance the books on it you know andobviously my world for operations it'sah something went bump in the night youknow why you know I think for thatassigning the owners is a deceptivelytricky case and you know just to reflecton it we've been through a few differentways of defining owners for a while wehad technical owner business ownersupport owner or on-call owner andsomehow those lists ended up being alittle bit different and that's a piecewhere the more we started to parsestudents okay well why why are thosedifferent we found what we're justpulling from different data sources andwe're not doing you know to keep harpingback to it not making our future livesEasier by not standardizing at the frontend so we then went through and did abit of a refactor on that you know havea bit of a rethink we said okaythis should be a lot simpler if you ownthe thing you need to be empowered tofix it and that actually drives some ofthe tool and roadmap for on theoperation side what we look to enableyou know how can we enable workflowautomation for teams to fix their ownproblemswhy we do that becomes a little moreobvious when you start to uncover thoseproblems okay well I shouldn't have topick which of the four teams that ownsthis thing I need to go reach out tolike that needs to be a one one-timeanswer I mean I don't know about you ifI get woken up at two in the morning I'mthe brain cells aren't all theredefinitely they get there butso simplifying those answers makes thatgovernance piece easier and I think it'sone of those things when you talk aboutthe scale aspect of it if you're notsetting yourselves up for Success thosethings that were easy and that oh youjust knew the guy who knew the guy whoowned that thing two years ago that kindof runs away from you on a hurry and allof a sudden you're looking back andsaying I don't even know what team thesepeople are on I don't know I don't knowwhere to chase it downI think if you get yourself into that 2A.M game of telephone not that peoplearen't happy to get online and help butwhen you're five people deep trying tofigure out who owns a domain that's nota great place to be so really figuringout how you want to Define ownership andwho you need in the mix is important andthat's you know paying the dividends foryourself down the line so thatAllen's near and dear just because wewent through that exercise a coupletimes over in the last year and I thinkcoming out the other side it feels likean oaha moment it seems super obviousbut it's it's not and it's worth puttingsome of the effort in up front and thatleads into the runtime governance whenyou're setting slos and then it getseasier okaywho do I pull into the room to figureout what the Agreements are going to behere well I know who owns these twothings and I'm not trying to figure outwho there are double secret owner isit's straight up this is the team that Ireach out to they can come and tell mewhat their actual boundary conditionsare what they can providesame point you obviously get back oncost governance so I know you asked mefor one and I gave you two but no that'sgreat jump out of me I think that'sreally important trying to figure outwhere that edge is so if you've got aVenn diagram of like one team andanother team there could be some overlapon that edge so it's important to knowwhere that handoff is or what might be asure concern between two teams yeah noexactly I mean we can hop back a fewslides if we want to if we dare try tosee how the back buttons working say goone or two more so we talk aboutbreaking down the site by those actualdomain it's going way too far back butmy apologies this one right here yeahthis works so you talk about thehandoffs between those teams and how wetry and Chase it down you know I thinkthat's adon't want to give me I like the buttonstoo muchand you talk about the handoffs betweenthese teams that's where having thoseclear domain boundaries helps and Ithink that's really the the flex pointbetween these two slides businessfunction provides a little more valuehere and when you talk about how youtreat this out especially in a moremicroservice based architecture rightone of the debates we're honestlyhappening nowtagged me by microservice is one thingbut looking at the actual applicationand roll up those are generally yourboundaries and then what happens withinit is it's not fungible but that's youknow for the team that owns it to figureout and have the expertise onso this view it looks a little scarierbecause there are you know more dotsmore grouping it's actually calmingbecause that's I know where theboundaries are between all our differentfunctionsit's the exact demarcations you stepback through say okay now when I'msetting the slos right that's the edgeI'm setting it ongotcha now on our end I think there's acouple tags that are important to usjust as a vendor but I think they mightbe if you're not digital clients mightbe important to you too so we've gotapplication or app then we'll haveservice so like which micro service isimportant to you and then the last oneis kind of that version so which whichversion of this software is that you'redeploying and of course Google providesus with a bunch of tags already themetadata will come from the cloudintegration so we get things like theregion The Zone what kind ofinfrastructure that you're actuallyusing with Google and maybe theenvironment as well that you will havetagged when you put it up to Google andcombining all of these tags togetherwill allow you to get that thatvisibility"
}